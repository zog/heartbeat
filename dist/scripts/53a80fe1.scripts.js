"use strict";angular.module("heartbeatApp",["ngCookies","ngResource","ngSanitize","ngRoute","heartbeatServices","webStorageModule"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),function(){angular.module("heartbeatApp").controller("MainCtrl",["$scope","Character","webStorage","$http","Bonus",function(a,b,c,d,e){return d.get("data/bonuses.json").success(function(d){var f,g,h,i;for(g=[],h=0,i=d.length;i>h;h++)f=d[h],g.push(new e(f,a,c));return a.bonuses=g,a.character=new b(a,c,g),a.showResetPopup=function(b){return null==b&&(b=!0),a.displayLocationDeletePopup=b?!0:!1}})}])}.call(this),function(){angular.module("heartbeatServices",["webStorageModule"])}.call(this),function(){var a,b;a=function(a,b,c){var d,e=this;return d=this,this.scope=a,this.webStorage=b,this.bonuses=c,this.stamina=this.webStorage.get("stamina")||0,this.baseBrain=this.webStorage.get("brain")||0,this.brainBonusFactor=1,this.staminaBonusFactor=1,this.incrementStamina=function(a){return null==a&&(a=null),null==a&&(a=e.defaultIncrement()),e.stamina+=a,e.save()},this.decrementStamina=function(a){return e.stamina-=a,e.save()},this.bonusBought=function(a){return e.decrementStamina(a.cost),e.computeBonusFactors()},this.period=function(){return 100},this.longPeriod=function(){return 1e4},this.bonus=function(a){var b,c,d,f;for(f=e.bonuses,c=0,d=f.length;d>c;c++)if(b=f[c],b.id===a)return b;return null},this.computeBonusFactors=function(){var a,b,c,d,f;for(e.brainBonusFactor=1,e.staminaBonusFactor=1,d=e.bonuses,f=[],b=0,c=d.length;c>b;b++)a=d[b],a.bought?(e.brainBonusFactor+=a.boost.brain_percent/100||0,f.push(e.staminaBonusFactor+=a.boost.stamina_percent/100||0)):f.push(void 0);return f},this.brain=function(){return e.baseBrain*e.brainBonusFactor},this.brainFactor=function(){return Math.sqrt(10*this.brain())},this.defaultIncrement=function(){return this.brainFactor()*this.period()/1e3*this.staminaBonusFactor},this.defaultIncrementPerS=function(){return 1e3*this.defaultIncrement()/this.period()},this.conversionRate=function(){return.1/Math.max(this.brainFactor(),1)},this.convert=function(){return e.baseBrain+=e.stamina*e.conversionRate(),e.stamina=0,e.computeBonusFactors(),e.save()},this.tick=function(){return e.incrementStamina(),e.scope.$apply(),setTimeout(function(){return e.tick()},e.period())},this.tack=function(){return e.save(),setTimeout(function(){return e.tack()},e.longPeriod())},this.save=function(){return e.webStorage.add("stamina",e.stamina),e.webStorage.add("brain",e.baseBrain)},this.reset=function(){var a,b,c,d;for(e.stamina=e.baseBrain=0,e.brainBonusFactor=e.staminaBonusFactor=1,d=e.bonuses,b=0,c=d.length;c>b;b++)a=d[b],a.unbuy();return e.save()},setTimeout(function(){return e.tick()},this.period()),this.computeBonusFactors(),this.tack(),d},b=angular.module("heartbeatServices"),b.factory("Character",["$rootScope",function(){return a}])}.call(this),function(){var a,b;a=function(a,b,c){var d,e,f=this;d=this,this.scope=b,this.webStorage=c;for(e in a)d[e]=a[e];return this.bought=this.webStorage.get("bonus["+this.id+"]")||!1,this.character=function(){return f.scope.character},this.buy=function(){return f.bought=!0,b.character.bonusBought(d),f.save()},this.unbuy=function(){return f.bought=!1,f.save()},this.save=function(){return f.webStorage.add("bonus["+f.id+"]",f.bought)},this.buyable=function(){var a,b,c,d,e;for(b=f.cost<f.character().stamina&&!f.bought,e=f.needs||[],c=0,d=e.length;d>c;c++)a=e[c],b&&(b=f.character().bonus(a).bought);return b},d},b=angular.module("heartbeatServices"),b.factory("Bonus",["$rootScope",function(){return a}])}.call(this);